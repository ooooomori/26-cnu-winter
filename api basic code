package com.example.demo.dictionary;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

/**
 * 한국어기초사전 Open API 연동 컨트롤러
 *
 * 역할:
 * - 한국어 / 외국어 단어 검색
 * - 뜻, 예문, 번역어 정보 제공
 * - 외부 API(XML 응답)를 그대로 프론트엔드에 전달
 *
 * 예시 요청:
 *  GET /api/dictionary?word=사랑&lang=kr
 *  GET /api/dictionary?word=love&lang=en
 */
@RestController
public class DictionaryController {

    /**
     * 단어 검색 API
     *
     * @param word 검색할 단어 (한국어 또는 외국어)
     * @param lang 검색 기준 언어 (kr, en, ja, zh)
     * @return 한국어기초사전 Open API XML 응답
     */
    @GetMapping("/api/dictionary")
    public String searchDictionary(
            @RequestParam String word,
            @RequestParam String lang
    ) {

        // TODO: 실제 서비스에서는 application.yml로 분리
        String apiKey = "YOUR_API_KEY";

        // 한국어기초사전 search API URL 구성
        String url = "https://krdict.korean.go.kr/api/search"
                + "?key=" + apiKey
                + "&q=" + word
                + "&lang=" + lang
                + "&req_type=xml";

        RestTemplate restTemplate = new RestTemplate();

        // 외부 API 호출 후 XML 응답을 그대로 반환
        return restTemplate.getForObject(url, String.class);
    }

    /**
     * 단어 상세 조회 API (활용형 정보)
     *
     * search API 결과에서 target_code를 받아
     * 활용형(conjugation) 정보를 조회할 때 사용
     *
     * 예시 요청:
     *  GET /api/dictionary/view?targetCode=123456
     */
    @GetMapping("/api/dictionary/view")
    public String viewDictionaryDetail(
            @RequestParam("targetCode") String targetCode
    ) {

        // TODO: 실제 서비스에서는 application.yml로 분리
        String apiKey = "YOUR_API_KEY";

        // 한국어기초사전 view API URL 구성
        String url = "https://krdict.korean.go.kr/api/view"
                + "?key=" + apiKey
                + "&target_code=" + targetCode
                + "&req_type=xml";

        RestTemplate restTemplate = new RestTemplate();

        // 활용형 포함 XML 응답 반환
        return restTemplate.getForObject(url, String.class);
    }
}
